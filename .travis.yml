language: julia
julia:
  # Test against these exact versions
  #- 0.6.2
  - 0.6.3
dist: trusty
sudo: false
matrix:
  include:
    - os: linux
      before_install:
        - docker build -t ubuntu_with_cmake .ci
   
    # OSX build using clang
    - os: osx
      compiler: "clang"

install:
  # On Linux, do the build within docker, on OSX just run the build directly
  - set -x; if [ $(uname) == Linux ]; then
        DOCKER_PATH=$(docker run -t ubuntu_with_cmake /bin/sh -c 'echo "$PATH"');
        JULIA_DIR=$(dirname $(which julia));
        docker run -t -e PATH="${JULIA_DIR}/bin:${DOCKER_PATH}" -v ${JULIA_DIR}:${JULIA_DIR} -v $(pwd):$(pwd) -w $(pwd) ubuntu_with_cmake .ci/build.sh;
    elif [ $(uname) == Darwin ]; then
      .ci/build.sh;
    fi

script:
  - cd build && ctest -V

notifications:
  email: true

language: julia
os:
  - linux
  addons:
    apt:
      sources:
        - ubuntu-toolchain-r-test
      packages:
        - g++-7
  env:
    - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"
  - osx
julia:
  - 1.0
  - 1.1
  - 1.2
  - nightly
notifications:
  email: true

script:
  - eval "${MATRIX_EVAL}"
  - mkdir build && cd build
  - cmake -DCMAKE_INSTALL_PREFIX=$HOME/install -DCMAKE_BUILD_TYPE=Release ..
  - VERBOSE=ON cmake --build . --config Release --target install
  - JLCXX_DIR=$PWD julia -e 'using Pkg; pkg"add CxxWrap#master"; Pkg.build(); using CxxWrap'
  - ctest -V
  - cd ../testlib-builder
  - mkdir build && cd build
  - cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=$HOME/install ../src/testlib
  - cmake --build . --config Release

